<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Books</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
    <div id="booksList"></div>

    <form id="addBookForm">
        <label for="title">Title: </label>
        <input id="title" type="text" name="title" placeholder="Title"> <br>
        <label for="author">Author: </label>
        <input id="author" type="text" name="author" placeholder="Author"> <br>
        <button type="submit">OK</button>
    </form>

    <script>
        $(document).ready(function () {  
            function renderBooks(books) {
                var booksList = $('#booksList');
                booksList.empty();
                if (books.length === 0) {
                    booksList.append('<p>No books</p>');
                } else {
                    var ul = $('<ul></ul>');
                    books.forEach(function (book) {
                        var li = $('<li data-book-id="' + book._id + '"></li>');
                        var deleteButton = $('<button class="deleteButton">Delete</button>');
                        var editButton = $('<button class="editButton">Edit</button>');
                        li.append(document.createTextNode(book.title + ' - ' + book.author));
                        li.append(deleteButton);
                        li.append(editButton);
                        ul.append(li);
                    });
                    booksList.append(ul);
                }
            }
            
            function fetchBooks() {
                $.ajax({
                    url: '/api/books',
                    type: 'GET',
                    success: function (data) {
                        renderBooks(data);
                    },
                    error: function (error) {
                        console.error('Error fetching books:', error);
                    }
                });
            }

            fetchBooks();

            $('#addBookForm').submit(function (event) {
                event.preventDefault();
                var title = $('#title').val();
                var author = $('#author').val();
                $.ajax({
                    url: '/api/books',
                    type: 'POST',
                    data: { title: title, author: author },
                    success: function () {
                        fetchBooks();
                        $('#title').val('');
                        $('#author').val('');
                    },
                    error: function (error) {
                        console.error('Error adding book:', error);
                    }
                });
            });

            $('#booksList').on('click', '.deleteButton', function () {
                var bookId = $(this).parent().data('book-id');
                $.ajax({
                    url: '/api/books/' + bookId,
                    type: 'DELETE',
                    success: function () {
                        fetchBooks();
                    },
                    error: function (error) {
                        console.error('Error deleting book:', error);
                    }
                });
            });
        });
    </script>
</body>
</html>